# =============================================================================
# PlayLexi — Cloudflare Wrangler Configuration
# =============================================================================
#
# This file configures Cloudflare Workers/Pages for the PlayLexi application.
#
# ## Setup Steps
#
# 1. Create a Cloudflare account at https://dash.cloudflare.com
# 2. Install Wrangler: npm install -g wrangler
# 3. Login: npx wrangler login
# 4. Create D1 database: npx wrangler d1 create playlexi-db
# 5. Update database_id below with your actual ID
# 6. Create R2 bucket: npx wrangler r2 bucket create playlexi-assets
#
# ## Local Development
#
# Run `npm run dev` — Wrangler automatically provides local D1 and R2 bindings.
#
# ## Deployment
#
# This app uses Cloudflare Pages (via next-on-pages), not Workers directly.
# Pages deployment is handled via GitHub integration or `npm run deploy`.
#
# @see docs/ARCHITECTURE.md Section 1.3 (Infrastructure)
# =============================================================================

name = "playlexi"
compatibility_date = "2024-01-01"

# =============================================================================
# D1 DATABASE
# =============================================================================
#
# D1 is Cloudflare's serverless SQL database (SQLite at the edge).
#
# To create your database:
#   npx wrangler d1 create playlexi-db
#
# Then copy the database_id from the output and paste it below.
# =============================================================================

[[d1_databases]]
binding = "DB"                        # How you access it in code: env.DB
database_name = "playlexi-db"         # Human-readable name
database_id = "YOUR_DATABASE_ID_HERE" # Replace after running: wrangler d1 create

# Preview database for development/staging
# Creates an isolated database for non-production environments
preview_database_id = "DB"

# =============================================================================
# R2 STORAGE (Object Storage)
# =============================================================================
#
# R2 stores:
# - Audio pronunciation files from Merriam-Webster (pre-cached)
# - User avatars (future)
#
# To create your bucket:
#   npx wrangler r2 bucket create playlexi-assets
# =============================================================================

[[r2_buckets]]
binding = "ASSETS"                    # How you access it in code: env.ASSETS
bucket_name = "playlexi-assets"       # Bucket name in Cloudflare dashboard

# =============================================================================
# ENVIRONMENT VARIABLES
# =============================================================================
#
# Secrets should NOT be in this file. Use wrangler secret:
#   npx wrangler secret put MERRIAM_WEBSTER_API_KEY
#   npx wrangler secret put GOOGLE_CLOUD_PROJECT_ID
#   npx wrangler secret put GOOGLE_CLOUD_CLIENT_EMAIL
#   npx wrangler secret put GOOGLE_CLOUD_PRIVATE_KEY
#
# Non-secret environment variables can go here:
# =============================================================================

[vars]
ENVIRONMENT = "development"

# Production overrides
[env.production.vars]
ENVIRONMENT = "production"

# =============================================================================
# BUILD CONFIGURATION
# =============================================================================
#
# For Next.js on Cloudflare Pages, the build is handled by next-on-pages.
# This section is mainly for reference.
# =============================================================================

# Not needed for Pages deployment, but useful for local wrangler dev
# [build]
# command = "npm run build"

# =============================================================================
# MIGRATIONS
# =============================================================================
#
# D1 migrations are stored in the migrations/ directory.
#
# To generate a migration from schema changes:
#   npx drizzle-kit generate:sqlite
#
# To apply migrations:
#   npx wrangler d1 migrations apply playlexi-db --local  # Local
#   npx wrangler d1 migrations apply playlexi-db          # Production
# =============================================================================

# Drizzle handles migrations, but you can also use D1 native migrations
# migrations_dir = "migrations"
